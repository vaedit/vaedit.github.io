<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Vaedit的博客</title>
  
  <subtitle>运维技术博客</subtitle>
  <link href="https://www.1000b1.com/atom.xml" rel="self"/>
  
  <link href="https://www.1000b1.com/"/>
  <updated>2020-10-10T09:00:38.491Z</updated>
  <id>https://www.1000b1.com/</id>
  
  <author>
    <name>Vaedit</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>curl报错记录</title>
    <link href="https://www.1000b1.com/3a6ce56f.html"/>
    <id>https://www.1000b1.com/3a6ce56f.html</id>
    <published>2020-10-10T08:42:56.000Z</published>
    <updated>2020-10-10T09:00:38.491Z</updated>
    
    
    <summary type="html">Centos下curl报错curl:(35)SSLconnecterror</summary>
    
    
    
    <category term="故障记录" scheme="https://www.1000b1.com/categories/%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="curl" scheme="https://www.1000b1.com/tags/curl/"/>
    
  </entry>
  
  <entry>
    <title>Django2.2-DateTimeField去掉微秒</title>
    <link href="https://www.1000b1.com/2488942.html"/>
    <id>https://www.1000b1.com/2488942.html</id>
    <published>2020-09-23T09:08:24.000Z</published>
    <updated>2020-10-10T09:00:45.974Z</updated>
    
    
    <summary type="html">&lt;h4 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Django 2.2&lt;/li&gt;
&lt;li&gt;Mysql 5.7&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;问题&quot;&gt;&lt;a href=&quot;#问题&quot; class=&quot;headerlink&quot; title=&quot;问题&quot;&gt;&lt;/a&gt;问题&lt;/h4&gt;&lt;p&gt;不管如何设置时间格式，数据库字段保存都有微秒(我的需求是去掉微秒)，如下图&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://vaedit-images.oss-cn-beijing.aliyuncs.com/img/image-20200923171022616.png&quot; alt=&quot;image-20200923171022616&quot;&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#models中定义字段&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;exetime = models.DateTimeField(auto_now_add=&lt;span class=&quot;literal&quot;&gt;True&lt;/span&gt;,verbose_name=&lt;span class=&quot;string&quot;&gt;&amp;#x27;执行时间&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="python运维" scheme="https://www.1000b1.com/categories/python%E8%BF%90%E7%BB%B4/"/>
    
    
    <category term="Django" scheme="https://www.1000b1.com/tags/Django/"/>
    
  </entry>
  
  <entry>
    <title>mysqldump</title>
    <link href="https://www.1000b1.com/df2ed841.html"/>
    <id>https://www.1000b1.com/df2ed841.html</id>
    <published>2020-09-22T13:15:14.000Z</published>
    <updated>2020-10-10T09:01:29.851Z</updated>
    
    
    <summary type="html">&lt;h3 id=&quot;常用参数&quot;&gt;&lt;a href=&quot;#常用参数&quot; class=&quot;headerlink&quot; title=&quot;常用参数&quot;&gt;&lt;/a&gt;常用参数&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;-A/–all-databases 备份所有数据库&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;-B/–databases 备份多个库&lt;/p&gt;
  &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysqldump -uxx -pxxx -B 库名1 库名2 &amp;gt;xxx.sql&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;–single-transaction 只用于innodb引擎，用于保证备份数据时的一致性&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;–master-data=1/2&lt;/p&gt;
&lt;p&gt;  该选项将二进制日志的位置和文件名写入到输出中。该选项要求有RELOAD权限，并且必须启用二进制日志。如果该选项值等于1，位置和文件名被写入CHANGE MASTER语句形式的转储输出，如果你使用该SQL转储主服务器以设置从服务器，从服务器从主服务器二进制日志的正确位置开始。如果选项值等于2，CHANGE MASTER语句被写成SQL注释。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="数据库" scheme="https://www.1000b1.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysqldump" scheme="https://www.1000b1.com/tags/mysqldump/"/>
    
  </entry>
  
  <entry>
    <title>mysqlhotcopy</title>
    <link href="https://www.1000b1.com/14f2069a.html"/>
    <id>https://www.1000b1.com/14f2069a.html</id>
    <published>2020-09-22T13:15:06.000Z</published>
    <updated>2020-10-10T09:01:34.895Z</updated>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;mysqlhotcopy的使用，只能备份MYISAM引擎数据库&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#安装&quot; class=&quot;headerlink&quot; title=&quot;安装&quot;&gt;&lt;/a&gt;安装&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install -y perl perl-DBI perl-DBD-MySQL&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;需要创建一个专门用来备份的账户&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;grant select,reload,lock tables on *.* to &amp;#39;hotcopyer&amp;#39;@&amp;#39;localhost&amp;#39; identified by &amp;#39;123456&amp;#39;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;常用选项和示例&quot;&gt;&lt;a href=&quot;#常用选项和示例&quot; class=&quot;headerlink&quot; title=&quot;常用选项和示例&quot;&gt;&lt;/a&gt;常用选项和示例&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysqlhotcopy -u ... -p password -S /tmp/...sock  库名(多库名空格隔开) 备份的目录&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# -u -p 后面必须有空格 可以加一个--flushlog 刷新2进制文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mysqlhotcopy -u ... -p ... -S ...  原库名 新库名  &lt;span class=&quot;comment&quot;&gt;#会在mysql datadir下产生一个新库目录&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ul&gt;
&lt;li&gt;-q 安静模式 &lt;/li&gt;
&lt;li&gt;–flushlog 刷新2进制日志&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="数据库" scheme="https://www.1000b1.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="mysqlhotcopy" scheme="https://www.1000b1.com/tags/mysqlhotcopy/"/>
    
  </entry>
  
  <entry>
    <title>Mysql二进制日志恢复</title>
    <link href="https://www.1000b1.com/70b491cf.html"/>
    <id>https://www.1000b1.com/70b491cf.html</id>
    <published>2020-09-22T13:13:36.000Z</published>
    <updated>2020-10-10T09:01:22.511Z</updated>
    
    
    <summary type="html">&lt;h3 id=&quot;二进制日志导出&quot;&gt;&lt;a href=&quot;#二进制日志导出&quot; class=&quot;headerlink&quot; title=&quot;二进制日志导出&quot;&gt;&lt;/a&gt;二进制日志导出&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;按时间节点导出&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt; –no-defaults 用来对mysql5.5之前mysqlbinlog命令报错&lt;/p&gt;
&lt;/blockquote&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysqlbinlog --no-defaults --start-date=&lt;span class=&quot;string&quot;&gt;&amp;quot;2017-08-08 15:04:04&amp;quot;&lt;/span&gt; --stop-date=&lt;span class=&quot;string&quot;&gt;&amp;quot;2017-08-08 15:12:00&amp;quot;&lt;/span&gt; /program/mysql1/mysql-bin.000001&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;按pos节点导出&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysqlbinlog --no-defaults mysql-bin.000003 --start-position=&lt;span class=&quot;string&quot;&gt;&amp;quot;622&amp;quot;&lt;/span&gt; --stop-position=&lt;span class=&quot;string&quot;&gt;&amp;quot;712&amp;quot;&lt;/span&gt; &amp;gt;xx.sql&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;按pos节点只导出某个库&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysqlbinlog --no-defaults --database=库名 --start-position=4 --stop-position=98 mysql-bin.000001 &amp;gt; test.sql&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;多个二进制日志导出&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;mysqlbinlog --database=&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt; /opt/data/APP01bin.000001 /opt/data/APP01bin.000002 &amp;gt;test.sql &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="数据库" scheme="https://www.1000b1.com/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
    <category term="binlog恢复" scheme="https://www.1000b1.com/tags/binlog%E6%81%A2%E5%A4%8D/"/>
    
  </entry>
  
  <entry>
    <title>Iptables端口转发</title>
    <link href="https://www.1000b1.com/818ac74b.html"/>
    <id>https://www.1000b1.com/818ac74b.html</id>
    <published>2020-09-22T13:10:31.000Z</published>
    <updated>2020-09-23T10:09:14.695Z</updated>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Linux下iptables不仅可以用来做防火墙还可以用来做端口转发&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;示例：&quot;&gt;&lt;a href=&quot;#示例：&quot; class=&quot;headerlink&quot; title=&quot;示例：&quot;&gt;&lt;/a&gt;示例：&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;将本机的8080端口转发至其他主机，主机IP：192.168.1.12，目标主机IP和端口：192.168.1.13:8088，规则如下&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;iptables -t nat -A PREROUTING -p tcp -m tcp --dport 8080 -j DNAT --to-destination 192.168.1.13:8088&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;iptables -t nat -A POSTROUTING -p tcp -m tcp --dport 8088 -j SNAT --to-source 192.168.1.12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; 1 &amp;gt; /proc/sys/net/ipv4/ip_forward &lt;span class=&quot;comment&quot;&gt;#开启iptables forward转发功能。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;tcp范围端口映射&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;iptables -t nat -A PREROUTING -p tcp --dport 2000:2500 -j DNAT --to 192.168.66.2:2000-2500&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux基础服务" scheme="https://www.1000b1.com/categories/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="iptables" scheme="https://www.1000b1.com/tags/iptables/"/>
    
  </entry>
  
  <entry>
    <title>openssl升级</title>
    <link href="https://www.1000b1.com/ceb34f9a.html"/>
    <id>https://www.1000b1.com/ceb34f9a.html</id>
    <published>2020-09-22T13:07:26.000Z</published>
    <updated>2020-09-25T06:31:42.334Z</updated>
    
    
    <summary type="html">Linux下openssl源码包升级</summary>
    
    
    
    <category term="Linux基础服务" scheme="https://www.1000b1.com/categories/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="openssl" scheme="https://www.1000b1.com/tags/openssl/"/>
    
  </entry>
  
  <entry>
    <title>Linux-ssh隧道详解</title>
    <link href="https://www.1000b1.com/d517a7ab.html"/>
    <id>https://www.1000b1.com/d517a7ab.html</id>
    <published>2020-09-22T13:02:19.000Z</published>
    <updated>2020-09-23T10:09:14.696Z</updated>
    
    
    <summary type="html">&lt;h4 id=&quot;隧道原理&quot;&gt;&lt;a href=&quot;#隧道原理&quot; class=&quot;headerlink&quot; title=&quot;隧道原理&quot;&gt;&lt;/a&gt;隧道原理&lt;/h4&gt;&lt;p&gt;隧道是一种把一种网络协议封装进另外一种网络协议进行传输的技术。这里我们研究ssh隧道，所以所有的网络通讯都是加密的。又被称作端口转发，因为ssh隧道通常会绑定一个本地端口，所有发向这个端口端口的数据包，都会被加密并透明地传输到远端系统。&lt;/p&gt;
&lt;h4 id=&quot;隧道的类型&quot;&gt;&lt;a href=&quot;#隧道的类型&quot; class=&quot;headerlink&quot; title=&quot;隧道的类型&quot;&gt;&lt;/a&gt;隧道的类型&lt;/h4&gt;&lt;h5 id=&quot;ssh隧道有3种类型：&quot;&gt;&lt;a href=&quot;#ssh隧道有3种类型：&quot; class=&quot;headerlink&quot; title=&quot;ssh隧道有3种类型：&quot;&gt;&lt;/a&gt;ssh隧道有3种类型：&lt;/h5&gt;&lt;ul&gt;
&lt;li&gt;动态端口转发（Socks 代理）&lt;/li&gt;
&lt;li&gt;本地端口转发&lt;/li&gt;
&lt;li&gt;远端端口转发&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Linux基础服务" scheme="https://www.1000b1.com/categories/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="ssh隧道" scheme="https://www.1000b1.com/tags/ssh%E9%9A%A7%E9%81%93/"/>
    
  </entry>
  
  <entry>
    <title>Vsftpd服务</title>
    <link href="https://www.1000b1.com/6900bf65.html"/>
    <id>https://www.1000b1.com/6900bf65.html</id>
    <published>2020-09-22T12:58:47.000Z</published>
    <updated>2020-09-23T10:09:14.701Z</updated>
    
    
    <summary type="html">&lt;h3 id=&quot;安装vsftpd&quot;&gt;&lt;a href=&quot;#安装vsftpd&quot; class=&quot;headerlink&quot; title=&quot;安装vsftpd&quot;&gt;&lt;/a&gt;安装vsftpd&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install vsftpd -y&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h4 id=&quot;系统认证&quot;&gt;&lt;a href=&quot;#系统认证&quot; class=&quot;headerlink&quot; title=&quot;系统认证&quot;&gt;&lt;/a&gt;系统认证&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;vi /etc/vsftpd/vsftpd.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[root@localhost pub]&lt;span class=&quot;comment&quot;&gt;# egrep -v &amp;quot;#|^$&amp;quot; /etc/vsftpd/vsftpd.conf &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;anonymous_enable=NO&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;local_enable=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;write_enable=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;local_umask=022&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dirmessage_enable=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;xferlog_enable=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;connect_from_port_20=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;xferlog_file=/var/&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;/xferlog&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;xferlog_std_format=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chroot_list_enable=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;chroot_list_file=/etc/vsftpd/chroot_list&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;listen=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pam_service_name=vsftpd&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;userlist_enable=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tcp_wrappers=YES&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#启动服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;service vsftpd start&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#创建用户 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;useradd -s /sbin/nologin backup&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;passwd backup &lt;span class=&quot;comment&quot;&gt;#设置密码&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;touch /etc/vsftpd/chroot_list&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux基础服务" scheme="https://www.1000b1.com/categories/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="ftp" scheme="https://www.1000b1.com/tags/ftp/"/>
    
  </entry>
  
  <entry>
    <title>迁移记录</title>
    <link href="https://www.1000b1.com/7a001119.html"/>
    <id>https://www.1000b1.com/7a001119.html</id>
    <published>2020-09-22T10:47:18.000Z</published>
    <updated>2020-09-23T10:09:14.712Z</updated>
    
    
      
      
        
        
    <summary type="html">&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span</summary>
        
      
    
    
    
    <category term="日志记录" scheme="https://www.1000b1.com/categories/%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="个人记录" scheme="https://www.1000b1.com/tags/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>企业级私有镜像仓库Harbor</title>
    <link href="https://www.1000b1.com/932165fe.html"/>
    <id>https://www.1000b1.com/932165fe.html</id>
    <published>2020-09-22T10:46:50.000Z</published>
    <updated>2020-09-25T06:32:43.307Z</updated>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;Harbor是vmware开源的一个私有镜像仓库软件，其提供了一个网页管理界面。&lt;br&gt; Harbor的安装需要先安装docker，docker-compose&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&quot;Docker安装：&quot;&gt;&lt;a href=&quot;#Docker安装：&quot; class=&quot;headerlink&quot; title=&quot;Docker安装：&quot;&gt;&lt;/a&gt;Docker安装：&lt;/h4&gt;&lt;p&gt;docker安装官方文档：&lt;a href=&quot;https://docs.docker.com/install/linux/docker-ce/centos/#install-using-the-repository&quot;&gt;https://docs.docker.com/install/linux/docker-ce/centos/#install-using-the-repository&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;yum install -y yum-utils device-mapper-persistent-data lvm2 &lt;span class=&quot;comment&quot;&gt;#安装必要的软件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum-config-manager --add-repo  &lt;span class=&quot;comment&quot;&gt;#添加docker官方源 &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install docker-ce &lt;span class=&quot;comment&quot;&gt;#安装docker社区版&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl start docker&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;附一个更改国内镜像源的方法：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# vi /etc/docker/daemon.json&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;registry-mirrors&amp;quot;&lt;/span&gt;: [ &lt;span class=&quot;string&quot;&gt;&amp;quot;https://registry.docker-cn.com&amp;quot;&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#改完后重启docker&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl restart docker&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="k8s生态圈" scheme="https://www.1000b1.com/categories/k8s%E7%94%9F%E6%80%81%E5%9C%88/"/>
    
    
    <category term="Harbor" scheme="https://www.1000b1.com/tags/Harbor/"/>
    
  </entry>
  
  <entry>
    <title>AWS-RDS慢查询日志查看导出</title>
    <link href="https://www.1000b1.com/5ed6ea01.html"/>
    <id>https://www.1000b1.com/5ed6ea01.html</id>
    <published>2020-09-22T10:41:17.000Z</published>
    <updated>2020-09-23T10:09:14.694Z</updated>
    
    
    <summary type="html">&lt;p&gt;如果要分析 slow log，第一步就是先要获取到 slow log 文件，由于 RDS MySQL 是托管数据库，我们无法登录到 MySQL 所在服务器，那么应该如何来获取 slow log 文件呢？&lt;/p&gt;
&lt;p&gt;根据 MySQL slow log 的相关配置，我们知道 slow log 的存在形式一共有两种： table 或 file ，由 log_output 参数进行控制：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TABLE (默认) – 将一般查询写入 general_log 表，将慢速查询写入 mysql.slow_log 表；&lt;/li&gt;
&lt;li&gt;FILE – 将一般查询日志和慢速查询日志写入文件系统；&lt;/li&gt;
&lt;li&gt;NONE – 禁用日志记录；&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;针对不同形式的 slow log，我们有不同的方法将其下载到本地：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;TABLE ：由于这是将慢查询记录存放在 MySQL 的数据表里，这里我们可以使用 sql 命令将其输出到本地的一个文件；&lt;/li&gt;
&lt;li&gt;FILE ：慢查询日志存放在 RDS MySQL 托管主机上，我们可以利用 awscli 提供的 RDS API download-db-log-file-portion 将 slow log 下载到本地；&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;具体实现形式请参加后续对应部分的内容。&lt;/p&gt;</summary>
    
    
    
    <category term="AWS服务" scheme="https://www.1000b1.com/categories/AWS%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="AWS慢查询日志" scheme="https://www.1000b1.com/tags/AWS%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97/"/>
    
    <category term="mysql" scheme="https://www.1000b1.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix实战-2</title>
    <link href="https://www.1000b1.com/32f6428a.html"/>
    <id>https://www.1000b1.com/32f6428a.html</id>
    <published>2020-09-22T10:37:10.000Z</published>
    <updated>2020-09-23T10:09:14.703Z</updated>
    
    
    <summary type="html">&lt;h4 id=&quot;安装Zabbix-agent环境&quot;&gt;&lt;a href=&quot;#安装Zabbix-agent环境&quot; class=&quot;headerlink&quot; title=&quot;安装Zabbix-agent环境&quot;&gt;&lt;/a&gt;安装Zabbix-agent环境&lt;/h4&gt;&lt;h5 id=&quot;1-初始化环境&quot;&gt;&lt;a href=&quot;#1-初始化环境&quot; class=&quot;headerlink&quot; title=&quot;1 初始化环境&quot;&gt;&lt;/a&gt;1 初始化环境&lt;/h5&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#192.168.0.161&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;setenforce 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl stop firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl &lt;span class=&quot;built_in&quot;&gt;enable&lt;/span&gt; firewalld&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h5 id=&quot;2-部署-Zabbix-Agent&quot;&gt;&lt;a href=&quot;#2-部署-Zabbix-Agent&quot; class=&quot;headerlink&quot; title=&quot;2 部署 Zabbix Agent&quot;&gt;&lt;/a&gt;2 部署 Zabbix Agent&lt;/h5&gt;&lt;p&gt;CentOS7.x操作系统安装：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-2.el7.noarch.rpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install zabbix-agent -y&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;CentOS6.x操作系统安装：&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;rpm -Uvh https://repo.zabbix.com/zabbix/4.0/rhel/6/x86_64/zabbix-release-4.0-2.el7.noarch.rpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum install zabbix-agent -y&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统监控" scheme="https://www.1000b1.com/categories/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="Zabbix" scheme="https://www.1000b1.com/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>Zabbix实战-1</title>
    <link href="https://www.1000b1.com/abff1330.html"/>
    <id>https://www.1000b1.com/abff1330.html</id>
    <published>2020-09-22T10:37:06.000Z</published>
    <updated>2020-09-23T10:09:14.703Z</updated>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;作者：Vaedit&lt;/p&gt;
&lt;p&gt;官网文档地址：&lt;a href=&quot;https://www.zabbix.com/cn/download?zabbix=4.0&amp;amp;os_distribution=centos&amp;amp;os_version=7&amp;amp;db=mysql&amp;amp;ws=apache&quot;&gt;https://www.zabbix.com/cn/download?zabbix=4.0&amp;amp;os_distribution=centos&amp;amp;os_version=7&amp;amp;db=mysql&amp;amp;ws=apache&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;实验环境&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;ip地址&lt;/th&gt;
&lt;th&gt;组件&lt;/th&gt;
&lt;th&gt;配置&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td&gt;192.168.0.160&lt;/td&gt;
&lt;td&gt;zabbix-server，php，mysql，zabbix-agent，zabbix-web，nginx等&lt;/td&gt;
&lt;td&gt;2核2G&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;192.168.0.161&lt;/td&gt;
&lt;td&gt;zabbix-agent，nginx&lt;/td&gt;
&lt;td&gt;2核2G&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;h4 id=&quot;安装zabbix-server环境&quot;&gt;&lt;a href=&quot;#安装zabbix-server环境&quot; class=&quot;headerlink&quot; title=&quot;安装zabbix-server环境&quot;&gt;&lt;/a&gt;安装zabbix-server环境&lt;/h4&gt;&lt;h5 id=&quot;1-初始化环境&quot;&gt;&lt;a href=&quot;#1-初始化环境&quot; class=&quot;headerlink&quot; title=&quot;1 初始化环境&quot;&gt;&lt;/a&gt;1 初始化环境&lt;/h5&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#192.168.0.160&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;setenforce 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl stop firewalld&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;systemctl &lt;span class=&quot;built_in&quot;&gt;enable&lt;/span&gt; firewalld&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统监控" scheme="https://www.1000b1.com/categories/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"/>
    
    
    <category term="Zabbix" scheme="https://www.1000b1.com/tags/Zabbix/"/>
    
  </entry>
  
  <entry>
    <title>vps编译php报错[ext/fileinfo/libmagic/apprentice.lo]</title>
    <link href="https://www.1000b1.com/fd6f40e2.html"/>
    <id>https://www.1000b1.com/fd6f40e2.html</id>
    <published>2020-09-22T10:31:44.000Z</published>
    <updated>2020-09-23T10:09:14.708Z</updated>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;php编译安装执行make时报错&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span</summary>
        
      
    
    
    
    <category term="故障记录" scheme="https://www.1000b1.com/categories/%E6%95%85%E9%9A%9C%E8%AE%B0%E5%BD%95/"/>
    
    
    <category term="php" scheme="https://www.1000b1.com/tags/php/"/>
    
  </entry>
  
  <entry>
    <title>AWS-EC2在线磁盘扩容</title>
    <link href="https://www.1000b1.com/b97f48ac.html"/>
    <id>https://www.1000b1.com/b97f48ac.html</id>
    <published>2020-09-22T10:29:39.000Z</published>
    <updated>2020-09-23T10:09:14.693Z</updated>
    
    
    <summary type="html">&lt;ol&gt;
&lt;li&gt;&lt;p&gt;首先先给需要扩容的磁盘卷制作快照&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;在控制台修改对应的的磁盘卷，把容量扩大，等待扩容进程走完成&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;查看文件系统&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;file -s /dev/nvme?n* &lt;span class=&quot;comment&quot;&gt;#查看文件系统&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;根据卷是否有分区，来决定是否需要执行扩展分区&lt;/p&gt;
 &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;lsblk &lt;span class=&quot;comment&quot;&gt;#查看磁盘&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NAME          MAJ:MIN RM SIZE RO TYPE MOUNTPOINT&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nvme1n1       259:0    0  30G  0 disk /data&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;nvme0n1       259:1    0  16G  0 disk&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└─nvme0n1p1   259:2    0   8G  0 part /&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;└─nvme0n1p128 259:3    0   1M  0 part&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#nvme1n1  没有分区，nvme0n1上有两个分区，有分区的卷需要执行扩展分区扩容&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;growpart /dev/nvme0n1 1 &lt;span class=&quot;comment&quot;&gt;#请注意，设备名称和分区编号之间有空格&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="AWS服务" scheme="https://www.1000b1.com/categories/AWS%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="磁盘扩容" scheme="https://www.1000b1.com/tags/%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9/"/>
    
  </entry>
  
  <entry>
    <title>Linux下制作RPM包工具fpm</title>
    <link href="https://www.1000b1.com/dbf9115.html"/>
    <id>https://www.1000b1.com/dbf9115.html</id>
    <published>2020-09-22T10:28:57.000Z</published>
    <updated>2020-09-25T06:34:12.753Z</updated>
    
    
    <summary type="html">&lt;h2 id=&quot;fpm工具安装&quot;&gt;&lt;a href=&quot;#fpm工具安装&quot; class=&quot;headerlink&quot; title=&quot;fpm工具安装&quot;&gt;&lt;/a&gt;fpm工具安装&lt;/h2&gt;&lt;h3 id=&quot;CentOS-6-x下安装&quot;&gt;&lt;a href=&quot;#CentOS-6-x下安装&quot; class=&quot;headerlink&quot; title=&quot;CentOS 6.x下安装&quot;&gt;&lt;/a&gt;CentOS 6.x下安装&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#centos6 由于自带yum源中的ruby版本太低，需要如下安装：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install rpm-build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum update nss&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;curl -sSL https://get.rvm.io | bash -s stable &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;source&lt;/span&gt; /etc/profile.d/rvm.sh&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rvm install 1.9.3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gem install fpm&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rvm use 1.9.3 --default &lt;span class=&quot;comment&quot;&gt;#选择ruby版本&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;h3 id=&quot;CentOS-7-x下安装&quot;&gt;&lt;a href=&quot;#CentOS-7-x下安装&quot; class=&quot;headerlink&quot; title=&quot;CentOS 7.x下安装&quot;&gt;&lt;/a&gt;CentOS 7.x下安装&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#安装ruby：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;yum -y install ruby rubygems ruby-devel rpm-build&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gem install fpm&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Linux基础服务" scheme="https://www.1000b1.com/categories/Linux%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1/"/>
    
    
    <category term="rpm包制作" scheme="https://www.1000b1.com/tags/rpm%E5%8C%85%E5%88%B6%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>Linux内核调优</title>
    <link href="https://www.1000b1.com/763b0dcd.html"/>
    <id>https://www.1000b1.com/763b0dcd.html</id>
    <published>2020-09-22T10:23:41.000Z</published>
    <updated>2020-09-25T06:34:00.813Z</updated>
    
    
    <summary type="html">&lt;h2 id=&quot;文件描述符和最大进程数&quot;&gt;&lt;a href=&quot;#文件描述符和最大进程数&quot; class=&quot;headerlink&quot; title=&quot;文件描述符和最大进程数&quot;&gt;&lt;/a&gt;文件描述符和最大进程数&lt;/h2&gt;&lt;h3 id=&quot;ulimit的使用&quot;&gt;&lt;a href=&quot;#ulimit的使用&quot; class=&quot;headerlink&quot; title=&quot;ulimit的使用&quot;&gt;&lt;/a&gt;ulimit的使用&lt;/h3&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;ulimit&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#-a 列出所有当前资源极限&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#-n 每个进程可以同时打开的最大文件数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#-u 可以运行的最大并发进程数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#-S 设置软限制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#-H 设置硬限制&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;在命令行直接执行该命令只会在当前shell生效，退出或者新开一个shell都会无效，所以可以加入到全局设置中：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/bin/&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;ulimit -SHn 65535&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; /etc/profile&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;有时候为了方便起见，也可以将用户资源的限制统一由一个文件来配置&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;这个文件就是/etc/security/limits.conf，该文件不但能对指定用户的资源进行限制，还能对指定组的资源进行限制。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;* hard nofile 65535&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt;/etc/security/limits.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;* soft nofile 65535&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt;/etc/security/limits.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;* soft nproc 65535&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt;/etc/security/limits.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;quot;* hard nproc 65535&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt;/etc/security/limits.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;需要注意的是，在centos系统中，除了/etc/security/limits.conf文件外，还有一个文件/etc/security/limits.d/20-nproc.conf（centos7.x系统），&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/etc/security/limits.d/90-nproc.conf（centos6.x系统），这个文件中，对nproc设置了一个默认值，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;并且是针对所有系统用户设置的。而如果在/etc/security/limits.conf文件中也设置了nproc值的话，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;则会被覆盖，也就是说/etc/security/limits.d/里面的文件的配置会覆盖/etc/security/limits.conf的配置。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;所以最好是删除该文件或者修改或者屏蔽该文件内容：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;/bin/sed -i &lt;span class=&quot;string&quot;&gt;&amp;#x27;s/1024/65535/g&amp;#x27;&lt;/span&gt;  /etc/security/limits.d/90-nproc.conf&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;或者：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rm -f /etc/security/limits.d/90-nproc.conf&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统调优" scheme="https://www.1000b1.com/categories/%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98/"/>
    
    
    <category term="Linux" scheme="https://www.1000b1.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Linux历史命令调优</title>
    <link href="https://www.1000b1.com/2b8a17fa.html"/>
    <id>https://www.1000b1.com/2b8a17fa.html</id>
    <published>2020-09-22T10:23:08.000Z</published>
    <updated>2020-09-23T10:09:14.698Z</updated>
    
    
    <summary type="html">&lt;h4 id=&quot;合理使用shell历史记录功能&quot;&gt;&lt;a href=&quot;#合理使用shell历史记录功能&quot; class=&quot;headerlink&quot; title=&quot;合理使用shell历史记录功能&quot;&gt;&lt;/a&gt;合理使用shell历史记录功能&lt;/h4&gt;&lt;p&gt;默认shell命令是存在.bash_history中，且不够详细，通过把以下命令写入到/etc/profile中，可以隐蔽的保存历史命令记录并方便审计。&lt;/p&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#history&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HISTDIR=/usr/share/.&lt;span class=&quot;built_in&quot;&gt;history&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;export&lt;/span&gt; HISTORY_FILE=&lt;span class=&quot;variable&quot;&gt;$&amp;#123;HISTDIR&amp;#125;&lt;/span&gt;/`date &lt;span class=&quot;string&quot;&gt;&amp;#x27;+%Y-%m-%d&amp;#x27;&lt;/span&gt;`.&lt;span class=&quot;built_in&quot;&gt;log&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ ! -d &lt;span class=&quot;variable&quot;&gt;$HISTDIR&lt;/span&gt; ];&lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mkdir -p &lt;span class=&quot;variable&quot;&gt;$HISTDIR&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; [ ! -f &lt;span class=&quot;variable&quot;&gt;$HISTORY_FILE&lt;/span&gt; ];&lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    touch &lt;span class=&quot;variable&quot;&gt;$HISTORY_FILE&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;readonly&lt;/span&gt; PROMPT_COMMAND=&lt;span class=&quot;string&quot;&gt;&amp;#x27;&amp;#123; date &amp;quot;+%Y-%m-%d %T ##### $(who am i |awk -v user=$USER &amp;quot;&amp;#123;print user \&amp;quot; \&amp;quot;\$2\&amp;quot; \&amp;quot;\$5&amp;#125;&amp;quot;) #### $(pwd) #### $(history 1 | &amp;#123; read x cmd; echo &amp;quot;$cmd&amp;quot;; &amp;#125;)&amp;quot;; &amp;#125; &amp;gt;&amp;gt; $HISTORY_FILE&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="系统调优" scheme="https://www.1000b1.com/categories/%E7%B3%BB%E7%BB%9F%E8%B0%83%E4%BC%98/"/>
    
    
    <category term="Linux" scheme="https://www.1000b1.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Shell并发编程</title>
    <link href="https://www.1000b1.com/ebb1f950.html"/>
    <id>https://www.1000b1.com/ebb1f950.html</id>
    <published>2020-09-22T10:21:42.000Z</published>
    <updated>2020-09-25T06:35:09.599Z</updated>
    
    
    <summary type="html">&lt;h4 id=&quot;案例1-通过文件描述符控制并发数&quot;&gt;&lt;a href=&quot;#案例1-通过文件描述符控制并发数&quot; class=&quot;headerlink&quot; title=&quot;案例1 通过文件描述符控制并发数&quot;&gt;&lt;/a&gt;案例1 通过文件描述符控制并发数&lt;/h4&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#用fifo处理shell下多进程并发：&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#!/bin/bash&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#author : vaedit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#date : 2017-8-15&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#需要执行的工作函数&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;title&quot;&gt;mima&lt;/span&gt;&lt;/span&gt;()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  openssl rand -base64 40 &amp;gt;&amp;gt; ssf.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#判断是否存在fifo文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;  [ -e /tmp/$$.fifo ];&lt;span class=&quot;keyword&quot;&gt;then&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  rm -rf /tmp/$$.fifo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;fi&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#创建$$.fifo 主要是为了防止同名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;fifo_file=/tmp/$$.fifo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;mkfifo &lt;span class=&quot;variable&quot;&gt;$fifo_file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#把文件表述符fd6和fifo文件绑定&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;exec&lt;/span&gt; 6&amp;lt;&amp;gt;&lt;span class=&quot;string&quot;&gt;&amp;quot;&lt;span class=&quot;variable&quot;&gt;$fifo_file&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;process_num=10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#向fd6中输入10个回车&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ((i=0;i&amp;lt;&lt;span class=&quot;variable&quot;&gt;$process_num&lt;/span&gt;;i++))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;done&lt;/span&gt; &amp;gt;&amp;amp;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#处理业务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; ((a=0;a&amp;lt;10;a++))  &lt;span class=&quot;comment&quot;&gt;#这里写10表示业务总条数，比如业务总共要执行100次，就填100&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;do&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;read&lt;/span&gt; -u6 &lt;span class=&quot;comment&quot;&gt;##read -u6命令执行一次，相当于尝试从fd6中获取一行，如果获取不到，则阻塞#获取到了一行后，fd6就少了一行了，开始处理子进程，子进程放在后台执行&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  mima&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sleep 3  &lt;span class=&quot;comment&quot;&gt;# 暂停3秒，这里是关键点，其实引入管道模拟多线程的关键就是为了这个暂停的3秒（实际上是微大于3秒的），让系统有个缓冲的时间，起到限制所谓并发的进程数量。&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;built_in&quot;&gt;echo&lt;/span&gt; &amp;gt;&amp;amp;6  &lt;span class=&quot;comment&quot;&gt;#表示向fd6中输入一行，补充刚才消耗的&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125; &amp;amp;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;done&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;wait&lt;/span&gt; &lt;span class=&quot;comment&quot;&gt;#等待所有的后台子进程结束&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;#关闭fd6&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;exec&lt;/span&gt; 6&amp;gt;&amp;amp;-&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="Shell脚本" scheme="https://www.1000b1.com/categories/Shell%E8%84%9A%E6%9C%AC/"/>
    
    
    <category term="Shell" scheme="https://www.1000b1.com/tags/Shell/"/>
    
  </entry>
  
</feed>
